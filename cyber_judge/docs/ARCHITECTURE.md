# ğŸ—ï¸ èµ›åšè£åˆ¤é•¿ - æ¶æ„è®¾è®¡æ–‡æ¡£

## è®¾è®¡ç†å¿µï¼šé‚¦å¤šåˆ©æ€€å­• (Bandori Pregnancy)

**æ ¸å¿ƒæ€æƒ³**: æ¨¡å—åŒ–ã€å¯ç»„åˆã€é«˜å¹¶å‘

- **æ¨¡å—åŒ–**: æ¯ä¸ªç»„ä»¶ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²
- **å¯ç»„åˆ**: ç»„ä»¶ä¹‹é—´é€šè¿‡æ¸…æ™°çš„æ¥å£ç»„åˆ
- **é«˜å¹¶å‘**: åˆ©ç”¨ Go å’Œ Python asyncio å®ç°é«˜å¹¶å‘

## ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·å±‚ (User Layer)                       â”‚
â”‚                    QQç¾¤ / Discord / Telegram                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åè®®å±‚ (Protocol Layer)                       â”‚
â”‚                  NapCatQQ / Discord.py / ...                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Application Layer)                    â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   The Body   â”‚  â”‚  The Brain   â”‚  â”‚  The Memory  â”‚         â”‚
â”‚  â”‚  (NoneBot2)  â”‚â—„â”€â”¤ (ReAct Loop) â”‚â—„â”€â”¤   (SQLite)   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                  â”‚                                     â”‚
â”‚         â”‚                  â–¼                                     â”‚
â”‚         â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚         â”‚          â”‚ Personality  â”‚                             â”‚
â”‚         â”‚          â”‚   Manager    â”‚                             â”‚
â”‚         â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚         â”‚                  â”‚                                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                            â–¼                                   â”‚ â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚ â”‚
â”‚                    â”‚   Cerebras   â”‚                           â”‚ â”‚
â”‚                    â”‚   API Client â”‚                           â”‚ â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                             â”‚                                     â”‚
                             â–¼                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¨ç†å±‚ (Inference Layer)                      â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Cerebras Cloud  â”‚              â”‚   Local Model    â”‚        â”‚
â”‚  â”‚  (Production)    â”‚              â”‚  (Experimental)  â”‚        â”‚
â”‚  â”‚  Llama 3.3 70B   â”‚              â”‚  Qwen 2.5 3B     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–²
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®å±‚ (Data Layer)                           â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ The Harvesterâ”‚â”€â–¶â”‚ The Refinery â”‚â”€â–¶â”‚  Examples    â”‚         â”‚
â”‚  â”‚  (Go Crawler)â”‚  â”‚ (Python ETL) â”‚  â”‚   Database   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. The Harvester (è¯­æ–™æ å¤º)

**æŠ€æœ¯æ ˆ**: Go + Colly

**èŒè´£**:
- é«˜å¹¶å‘æŠ“å–è´´å§ç²¾å“å†…å®¹
- ç»“æ„åŒ–æå–"æ¡ˆæƒ…-åˆ¤å†³"å¯¹
- è¿‡æ»¤å¹¿å‘Šå’Œæ— æ•ˆå†…å®¹

**æ€§èƒ½æŒ‡æ ‡**:
- å¹¶å‘æ•°: 10 goroutines
- æŠ“å–é€Ÿåº¦: ~100 å¸–/åˆ†é’Ÿ
- ç›®æ ‡æ•°æ®é‡: 500-1000 æ¡

**å…³é”®ä»£ç **:
```go
// harvester/main.go
func crawlJudgments(config Config) []Judgment {
    c := colly.NewCollector(colly.Async(true))
    c.Limit(&colly.LimitRule{
        Parallelism: config.Concurrency,
    })
    // ...
}
```

### 2. The Refinery (æ•°æ®æ¸…æ´—)

**æŠ€æœ¯æ ˆ**: Python + Pandas + LLM API

**èŒè´£**:
- æ¸…æ´—åŸå§‹æ•°æ®ï¼ˆå»HTMLã€è¡¨æƒ…åŒ…ã€è„è¯ï¼‰
- LLM è’¸é¦ï¼ˆæ”¹å†™ä¸ºæ ‡å‡†æ ¼å¼ï¼‰
- ç”Ÿæˆ Few-Shot ç¤ºä¾‹å’Œè®­ç»ƒæ•°æ®

**å¤„ç†æµç¨‹**:
```
åŸå§‹æ•°æ® â†’ æ–‡æœ¬æ¸…æ´— â†’ è´¨é‡è¯„åˆ† â†’ LLMè’¸é¦ â†’ æ ¼å¼åŒ–è¾“å‡º
```

**äº§å‡º**:
- `production_examples.txt`: Few-Shot ç¤ºä¾‹
- `train.jsonl`: è®­ç»ƒæ•°æ®

### 3. The Brain (å¤§è„‘)

**æŠ€æœ¯æ ˆ**: Python + Cerebras API / Unsloth

**èŒè´£**:
- æ¨ç†å’Œç”Ÿæˆå›å¤
- å®ç° ReAct å¾ªç¯
- ç®¡ç†å¤šé‡äººæ ¼

**ä¸¤ç§æ¨¡å¼**:

#### ç”Ÿäº§æ¨¡å¼ (Cerebras API)
- æ¨¡å‹: Llama 3.3 70B
- å»¶è¿Ÿ: ~200ms
- æˆæœ¬: ~$0.001/è¯·æ±‚
- ç­–ç•¥: System Prompt + Few-Shot

#### å®éªŒæ¨¡å¼ (æœ¬åœ° RTX 4060)
- æ¨¡å‹: Qwen 2.5 3B (LoRA)
- å»¶è¿Ÿ: ~500ms
- æˆæœ¬: 0
- ç­–ç•¥: å¾®è°ƒæ¨¡å‹

### 4. ReAct å¾ªç¯

**æ ¸å¿ƒç®—æ³•**:

```python
async def think_and_act(user_message, user_id):
    for iteration in range(max_iterations):
        # 1. æ€è€ƒ
        thought = await llm.think(user_message, context)
        
        # 2. å†³å®šè¡ŒåŠ¨
        if thought.action == "direct_reply":
            return thought.final_answer
        
        # 3. æ‰§è¡Œè¡ŒåŠ¨
        observation = await execute_action(thought.action)
        
        # 4. æ›´æ–°ä¸Šä¸‹æ–‡
        context.append(observation)
    
    # å¼ºåˆ¶ç”Ÿæˆå›å¤
    return await llm.generate_final(context)
```

**å¯ç”¨è¡ŒåŠ¨**:
- `direct_reply`: ç›´æ¥å›å¤
- `search_history`: æŸ¥è¯¢ç”¨æˆ·å†å²
- `search_web`: æœç´¢ç½‘ç»œ
- `analyze_pattern`: åˆ†æç”¨æˆ·æ¨¡å¼

### 5. å¹¶å‘å¤šé‡äººæ ¼

**å®ç°åŸç†**:

```python
async def get_best_response(message):
    # å¹¶å‘è¯·æ±‚ä¸‰ä¸ªäººæ ¼
    tasks = [
        llm.chat(message, personality="æš´èºè€å“¥"),
        llm.chat(message, personality="ç†ä¸­å®¢"),
        llm.chat(message, personality="é˜´é˜³äºº"),
    ]
    
    responses = await asyncio.gather(*tasks)
    
    # é€‰æ‹©æœ€ä½³å›å¤
    return max(responses, key=score_response)
```

**æ€§èƒ½ä¼˜åŠ¿**:
- ä¸²è¡Œ: 3 Ã— 200ms = 600ms
- å¹¶å‘: max(200ms, 200ms, 200ms) â‰ˆ 300ms
- **æé€Ÿ 2å€**

### 6. The Memory (è®°å¿†)

**æŠ€æœ¯æ ˆ**: SQLite / ChromaDB

**æ•°æ®æ¨¡å‹**:

```sql
-- ç”¨æˆ·æ¶ˆæ¯è¡¨
CREATE TABLE user_messages (
    id INTEGER PRIMARY KEY,
    user_id TEXT,
    message TEXT,
    timestamp DATETIME,
    group_id TEXT
);

-- åˆ¤å†³è®°å½•è¡¨
CREATE TABLE judgment_records (
    id INTEGER PRIMARY KEY,
    user_id TEXT,
    case_text TEXT,
    verdict TEXT,
    personality TEXT,
    timestamp DATETIME
);

-- ç”¨æˆ·ç»Ÿè®¡è¡¨
CREATE TABLE user_stats (
    user_id TEXT PRIMARY KEY,
    total_messages INTEGER,
    total_judgments INTEGER,
    first_seen DATETIME,
    last_seen DATETIME
);
```

### 7. The Body (èº¯å¹²)

**æŠ€æœ¯æ ˆ**: NoneBot2 + NapCatQQ

**æ¶ˆæ¯å¤„ç†æµç¨‹**:

```
QQæ¶ˆæ¯ â†’ NapCatQQ â†’ NoneBot2 â†’ Plugin â†’ ReAct Agent â†’ LLM â†’ å›å¤
```

**æ’ä»¶åŠŸèƒ½**:
- æ¶ˆæ¯è®°å½•
- åˆ¤å†³å¤„ç†
- æˆåˆ†æŸ¥è¯¢
- å¸®åŠ©ä¿¡æ¯

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. å»¶è¿Ÿå¥—åˆ©

åˆ©ç”¨ Cerebras çš„æé€Ÿ APIï¼Œå®ç°äºšç§’çº§å“åº”ï¼š

| æ“ä½œ | å»¶è¿Ÿ |
|------|------|
| å•æ¬¡æ¨ç† | ~200ms |
| å¹¶å‘ä¸‰äººæ ¼ | ~300ms |
| ReAct 3è½® | ~600ms |

### 2. ç¼“å­˜ç­–ç•¥

- **Few-Shot ç¼“å­˜**: é¢„åŠ è½½åˆ°å†…å­˜
- **ç”¨æˆ·å†å²ç¼“å­˜**: LRU ç¼“å­˜æœ€è¿‘ 100 ä¸ªç”¨æˆ·
- **åˆ¤å†³ç¼“å­˜**: ç›¸åŒé—®é¢˜ 1 å°æ—¶å†…è¿”å›ç¼“å­˜

### 3. å¼‚æ­¥å¤„ç†

- æ‰€æœ‰ I/O æ“ä½œä½¿ç”¨ asyncio
- æ•°æ®åº“æ“ä½œå¼‚æ­¥åŒ–
- API è°ƒç”¨å¹¶å‘åŒ–

## æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Bot 1   â”‚  â”‚ Bot 2   â”‚  â”‚ Bot 3   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚            â”‚            â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Shared DB    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‚ç›´æ‰©å±•

- å¢åŠ  Cerebras API å¹¶å‘é™åˆ¶
- ä½¿ç”¨æ›´å¤§çš„æ¨¡å‹ (Llama 3.3 70B)
- æ·»åŠ æœ¬åœ°æ¨¡å‹é›†ç¾¤

## å®‰å…¨æ€§è€ƒè™‘

1. **API Key ç®¡ç†**: ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œä¸æäº¤åˆ° Git
2. **è¾“å…¥éªŒè¯**: è¿‡æ»¤æ¶æ„è¾“å…¥
3. **é€Ÿç‡é™åˆ¶**: é˜²æ­¢æ»¥ç”¨
4. **æ•°æ®éšç§**: ç”¨æˆ·æ•°æ®åŠ å¯†å­˜å‚¨

## ç›‘æ§å’Œæ—¥å¿—

- **æ—¥å¿—çº§åˆ«**: DEBUG, INFO, WARNING, ERROR
- **ç›‘æ§æŒ‡æ ‡**: 
  - è¯·æ±‚å»¶è¿Ÿ
  - API è°ƒç”¨æ¬¡æ•°
  - é”™è¯¯ç‡
  - ç”¨æˆ·æ´»è·ƒåº¦

## æˆæœ¬ä¼°ç®—

### Cerebras API æˆæœ¬

- å•æ¬¡è¯·æ±‚: ~$0.001
- æ—¥æ´» 100 ç”¨æˆ·ï¼Œæ¯äºº 10 æ¬¡è¯·æ±‚: $1/å¤©
- æœˆæˆæœ¬: ~$30

### æœåŠ¡å™¨æˆæœ¬

- M3 Air: å·²æœ‰
- RTX 4060: å·²æœ‰
- æ€»æˆæœ¬: $0

**æ€»è®¡**: ~$30/æœˆ

