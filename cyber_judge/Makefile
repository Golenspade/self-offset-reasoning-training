# èµ›åšè£åˆ¤é•¿ - Makefile

.PHONY: help install crawl clean distill run-bot test

help:
	@echo "èµ›åšè£åˆ¤é•¿ - å¯ç”¨å‘½ä»¤:"
	@echo "  make install    - å®‰è£…æ‰€æœ‰ä¾èµ–"
	@echo "  make crawl      - è¿è¡Œçˆ¬è™«æŠ“å–æ•°æ®"
	@echo "  make clean      - æ¸…æ´—æ•°æ®"
	@echo "  make distill    - LLM è’¸é¦æ•°æ®"
	@echo "  make run-bot    - å¯åŠ¨ Bot"
	@echo "  make test       - è¿è¡Œæµ‹è¯•"
	@echo "  make all        - å®Œæ•´æµç¨‹ï¼ˆçˆ¬è™«->æ¸…æ´—->è’¸é¦ï¼‰"

install:
	@echo "ğŸ“¦ å®‰è£… Python ä¾èµ–..."
	pip install -r requirements.txt
	@echo "ğŸ“¦ å®‰è£… Go ä¾èµ–..."
	cd harvester && go mod download
	@echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"

crawl:
	@echo "ğŸ•·ï¸  å¯åŠ¨çˆ¬è™«..."
	cd harvester && go run main.go

clean:
	@echo "ğŸ§¹ æ¸…æ´—æ•°æ®..."
	python refinery/cleaner.py

distill:
	@echo "ğŸ§ª è’¸é¦æ•°æ®..."
	python refinery/distiller.py

run-bot:
	@echo "ğŸ¤– å¯åŠ¨èµ›åšè£åˆ¤é•¿..."
	cd body && python bot.py

test:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	pytest tests/ -v

all: crawl clean distill
	@echo "âœ… æ•°æ®å‡†å¤‡å®Œæˆï¼ç°åœ¨å¯ä»¥è¿è¡Œ make run-bot å¯åŠ¨ Bot"

# å¼€å‘ç›¸å…³
format:
	@echo "ğŸ¨ æ ¼å¼åŒ–ä»£ç ..."
	black .
	cd harvester && go fmt ./...

lint:
	@echo "ğŸ” ä»£ç æ£€æŸ¥..."
	flake8 .
	cd harvester && go vet ./...

# æ¸…ç†
clean-data:
	@echo "ğŸ—‘ï¸  æ¸…ç†æ•°æ®..."
	rm -rf data/raw/*
	rm -rf data/processed/*

clean-all: clean-data
	@echo "ğŸ—‘ï¸  æ¸…ç†æ‰€æœ‰ç”Ÿæˆæ–‡ä»¶..."
	rm -rf data/memory.db
	find . -type d -name "__pycache__" -exec rm -rf {} +
	find . -type f -name "*.pyc" -delete

